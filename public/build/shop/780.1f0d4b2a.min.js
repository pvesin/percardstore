"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[780],{5780:(t,e,o)=>{o.r(e),o.d(e,{default:()=>n});var i=o(9755),l=o.n(i);class a{constructor(t){this.addItem=this.addItem.bind(this),this.updateItem=this.updateItem.bind(this),this.deleteItem=this.constructor.deleteItem,this.updatePrototype=this.updatePrototype.bind(this),this.$element=l()(t),this.$list=this.$element.find('[data-form-collection="list"]:first'),this.count=this.$list.children().length,this.lastChoice=null,this.$element.on("click",'[data-form-collection="add"]:last',this.addItem),this.$element.on("click",'[data-form-collection="delete"]',this.deleteItem),this.$element.on("change",'[data-form-collection="update"]',this.updateItem),l()(document).on("change",'[data-form-prototype="update"]',this.updatePrototype),l()(document).on("collection-form-add",((t,e)=>{l()(e).find('[data-form-type="collection"]').CollectionForm(),l()(document).trigger("dom-node-inserted",[l()(e)])}))}addItem(t){t.preventDefault();let e=this.$element.data("prototype"),o=new RegExp(this.$element.data("prototype-name"),"g");e=e.replace(o,this.count),this.$list.append(e),this.count=this.count+1,l()(document).trigger("collection-form-add",[this.$list.children().last()])}updateItem(t){t.preventDefault();const e=l()(t.currentTarget),o=e.data("form-url"),i=e.val(),a=e.closest('[data-form-collection="item"]'),n=a.data("form-collection-index"),c=a.data("form-collection-index");if(o)a.load(o,{id:i,position:c});else{let t=this.$element.find(`[data-form-prototype="${i}"]`),e=new RegExp(t.data("subprototype-name"),"g"),o=t.val().replace(e,n);a.replaceWith(o)}l()(document).trigger("collection-form-update",[l()(t.currentTarget)])}static deleteItem(t){t.preventDefault(),l()(t.currentTarget).closest('[data-form-collection="item"]').remove(),l()(document).trigger("collection-form-delete",[l()(t.currentTarget)])}updatePrototype(t){const e=l()(t.currentTarget);let o=e.val();void 0!==e.data("form-prototype-prefix")&&(o=e.data("form-prototype-prefix")+o),null!==this.lastChoice&&this.lastChoice!==o&&this.$list.html(""),this.lastChoice=o,this.$element.data("prototype",this.$element.find(`[data-form-prototype="${o}"]`).val())}}l().fn.CollectionForm=function(t){this.each(((e,o)=>{const i=l()(o),n=i.data("collectionForm"),c="object"==typeof t&&t;n||i.data("collectionForm",new a(o,c))}))},l().fn.CollectionForm.Constructor=a;const n=()=>{l()('[data-form-type="collection"]').CollectionForm()}}}]);