"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[780],{5780:(t,e,o)=>{o.r(e),o.d(e,{default:()=>a});class l{constructor(t){this.addItem=this.addItem.bind(this),this.updateItem=this.updateItem.bind(this),this.deleteItem=this.deleteItem.bind(this),this.updatePrototype=this.updatePrototype.bind(this),this.$element=t,this.$list=this.$element.querySelector('[data-form-collection="list"]'),this.count=this.$list.children.length,this.lastChoice=null;const e=this.$element.querySelector('[data-form-collection="add"]');e&&e.addEventListener("click",this.addItem);[...this.$element.querySelectorAll('[data-form-collection="delete"]')].forEach((t=>{t.addEventListener("click",this.deleteItem)}));const o=this.$element.querySelector('[data-form-collection="update"]');o&&o.addEventListener("change",this.updateItem);const l=document.querySelector('[data-form-prototype="update"]');l&&l.addEventListener("change",this.updatePrototype),document.addEventListener("collection-form-add",(t=>{const e=t.detail[0],o=e.closest('[data-form-type="collection"]');n(o),e.querySelector('[data-form-collection="delete"]').addEventListener("click",this.deleteItem),document.dispatchEvent(new CustomEvent("dom-node-inserted",{detail:[e]}))}))}addItem(t){t.preventDefault();let e=this.$element.dataset,o=e.prototype,l=e.prototypeName;const n=new RegExp(l,"g");o=o.replace(n,this.count),this.$list.insertAdjacentHTML("beforeend",o),this.count=this.count+1,document.dispatchEvent(new CustomEvent("collection-form-add",{detail:[this.$list.lastElementChild]}))}updateItem(t){t.preventDefault();const e=t.currentTarget,o=e.dataset.formUrl,l=e.value,n=e.closest('[data-form-collection="item"]'),a=n.dataset.formCollectionIndex,i=n.dataset.formCollectionIndex;if(o)fetch(o,{id:l,position:i}).then((t=>t.text())).then((t=>{n.innerHTML=t}));else{let t=this.$element.querySelector(`[data-form-prototype="${l}"]`),e=new RegExp(t.dataset.subprototypeName,"g"),o=t.value.replace(e,a);n.parentNode.replaceChild(o,n)}document.dispatchEvent(new CustomEvent("collection-form-update",{detail:[t.currentTarget]}))}deleteItem(t){t.preventDefault(),t.currentTarget.closest('[data-form-collection="item"]').remove(),document.dispatchEvent(new CustomEvent("collection-form-delete",{detail:[t.currentTarget]}))}updatePrototype(t){const e=t.currentTarget;let o=e.value;void 0!==e.dataset.formPrototypePrefix&&(o=e.dataset.formPrototypePrefix+o),null!==this.lastChoice&&this.lastChoice!==o&&(this.$list.innerHTML=""),this.lastChoice=o;const l=this.$element.querySelector(`[data-form-prototype="${o}"]`).value;this.$element.data("prototype",l)}}const n=t=>{t.dataset.collectionForm||t.setAttribute("data-collection-form",new l(t))},a=()=>{[...document.querySelectorAll('[data-form-type="collection"]')].forEach((t=>{n(t)}))}}}]);